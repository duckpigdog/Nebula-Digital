function addToCart(pid){var payload={pid:pid,qty:1,time:Date.now()};location.href='/index.php?enc='+encodeURIComponent(e(JSON.stringify(payload)))}
function flash(){var payload={action:'flash',nonce:Date.now()};fetch('/api/admin_access.php?enc='+encodeURIComponent(e(JSON.stringify(payload)))).then(r=>r.json()).then(r=>{})}
function initSearch(){var f=document.querySelector('.search');if(!f)return;f.addEventListener('submit',function(ev){ev.preventDefault();var q=f.q.value.trim();if(!q)return;fetch('/api/products.php?enc='+encodeURIComponent(e(JSON.stringify({q:q,time:Date.now()})))).then(r=>r.json()).then(function(resp){if(!resp||!resp.list)return;var g=document.getElementById('grid');var html='';for(var i=0;i<resp.list.length;i++){var p=resp.list[i];html+=`<div class=\"card\"><img class=\"cover\" src=\"${p.cover}\" alt=\"\"><div class=\"title\">${p.title}</div><div class=\"price\">¥${Number(p.price).toFixed(2)}</div><button onclick=\"addToCart(${p.id})\">加入购物车</button></div>`}g.innerHTML=html})})}
document.addEventListener('DOMContentLoaded',initSearch)
